# 03-01: Mobile Touch Gestures

<objective>
Implement swipe gesture support for sliders on mobile devices, improving UX for touch users and making navigation more intuitive.
</objective>

<context>
@websites/www.dinero.cash/index.html
@websites/www.dinero.cash/assets/js/
@websites/www.dinero.cash/assets/css/
@.planning/STATE.md
</context>

<tasks>
<task name="Create touch gesture JavaScript module">
1. Create `assets/js/touch-gestures.js`
2. Add swipe detection logic:
   ```javascript
   (function() {
     // Touch gesture support for sliders
     'use strict';

     // Swipe detection configuration
     const SWIPE_THRESHOLD = 50; // Minimum pixels for swipe
     const SWIPE_VELOCITY = 0.3;  // Minimum velocity

     // Touch tracking for hero slider
     let heroTouchStartX = 0;
     let heroTouchStartY = 0;
     let heroTouchEndX = 0;
     let heroTouchEndY = 0;

     const heroSlider = $('.hero-slider');

     if (heroSlider.length) {
       const sliderMask = heroSlider.find('.w-slider-mask');

       sliderMask.on('touchstart', function(e) {
         heroTouchStartX = e.changedTouches[0].screenX;
         heroTouchStartY = e.changedTouches[0].screenY;
       }, { passive: true });

       sliderMask.on('touchend', function(e) {
         heroTouchEndX = e.changedTouches[0].screenX;
         heroTouchEndY = e.changedTouches[0].screenY;
         handleHeroSwipe();
       }, { passive: true });
     }

     function handleHeroSwipe() {
       const diffX = heroTouchStartX - heroTouchEndX;
       const diffY = heroTouchStartY - heroTouchEndY;

       // Only trigger if horizontal swipe exceeds vertical
       if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > SWIPE_THRESHOLD) {
         const leftArrow = $('#heroSlider .w-slider-arrow-left');
         const rightArrow = $('#heroSlider .w-slider-arrow-right');

         if (diffX > 0) {
           // Swipe left - next slide
           rightArrow.trigger('tap');
         } else {
           // Swipe right - previous slide
           leftArrow.trigger('tap');
         }
       }
     }

     // Touch tracking for features slider
     let featureTouchStartX = 0;
     let featureTouchStartY = 0;
     let featureTouchEndX = 0;
     let featureTouchEndY = 0;

     const featuresSlider = $('.features-popup-slider');

     if (featuresSlider.length) {
       const sliderMask = featuresSlider.find('.w-slider-mask');

       sliderMask.on('touchstart', function(e) {
         featureTouchStartX = e.changedTouches[0].screenX;
         featureTouchStartY = e.changedTouches[0].screenY;
       }, { passive: true });

       sliderMask.on('touchend', function(e) {
         featureTouchEndX = e.changedTouches[0].screenX;
         featureTouchEndY = e.changedTouches[0].screenY;
         handleFeatureSwipe();
       }, { passive: true });
     }

     function handleFeatureSwipe() {
       const diffX = featureTouchStartX - featureTouchEndX;
       const diffY = featureTouchStartY - featureTouchEndY;

       if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > SWIPE_THRESHOLD) {
         const leftArrow = $('#featuresSlider .w-slider-arrow-left');
         const rightArrow = $('#featuresSlider .w-slider-arrow-right');

         if (diffX > 0) {
           rightArrow.trigger('tap');
         } else {
           leftArrow.trigger('tap');
         }
       }
     }

     console.log('Touch gestures initialized');
   })();
   ```
3. Save file
</task>

<task name="Add visual feedback during swipe">
1. Open `assets/css/accessibility-improvements.css` (or create touch-gestures.css)
2. Add visual feedback styles:
   ```css
   /* Touch gesture feedback */
   .w-slider-mask {
     touch-action: pan-y; /* Allow vertical scrolling, handle horizontal swipe */
   }

   /* Visual feedback during swipe */
   .w-slider-mask.swiping {
     cursor: grabbing;
   }

   /* Prevent accidental horizontal scroll on sliders */
   .hero-slider,
   .features-popup-slider {
     touch-action: pan-x pinch-zoom;
   }
   ```
3. Save file
</task>

<task name="Add script reference to HTML files">
1. Open `index.html`
2. Find existing script tags near end of file
3. Add touch gestures script AFTER jQuery but before other interactive scripts:
   ```html
   <script src="assets/js/touch-gestures.js" defer></script>
   ```
4. Save index.html
5. Repeat for users.html and agents.html if they have sliders
</task>

<task name="Test swipe gestures on mobile devices">
1. Test on iOS device (iPhone/iPad):
   - Open index.html in Safari
   - Swipe left on hero slider → should advance to next slide
   - Swipe right → should go to previous slide
   - Verify vertical scrolling still works
   - Test feature popup slider
2. Test on Android device:
   - Open in Chrome
   - Same swipe tests as iOS
3. Test edge cases:
   - Quick swipes (should still trigger)
   - Slow swipes (should still trigger if > 50px)
   - Diagonal swipes (should use dominant direction)
   - Swipe during auto-advance (shouldn't conflict)
4. Document any issues found
</task>

<task name="Add swipe indicator hint for mobile users">
1. Open `accessibility-improvements.css`
2. Add swipe hint animation:
   ```css
   /* Swipe hint animation */
   @keyframes swipe-hint {
     0%, 100% { transform: translateX(0); opacity: 0.5; }
     50% { transform: translateX(-10px); opacity: 1; }
   }

   .swipe-hint {
     animation: swipe-hint 2s ease-in-out infinite;
     display: none; /* Only show on touch devices */
   }

   @media (hover: none) and (pointer: coarse) {
     .swipe-hint {
       display: inline-block;
     }
   }
   ```
3. Add swipe hint icons to slider navigation (small chevron animation)
4. Test on touch device to verify hint shows
5. Save files
</task>
</tasks>

<success>
- [ ] `touch-gestures.js` created with swipe detection
- [ ] Hero slider supports swipe left (next) and right (previous)
- [ ] Features slider supports swipe gestures
- [ ] 50px threshold implemented for swipe detection
- [ ] Visual feedback added during swipes
- [ ] Script references added to all HTML files
- [ ] Swipe gestures work on iOS Safari
- [ ] Swipe gestures work on Android Chrome
- [ ] Vertical scrolling not affected
- [ ] Swipe hint animation shown on touch devices
- [ ] Edge cases tested (quick swipes, slow swipes, diagonal)
</success>
