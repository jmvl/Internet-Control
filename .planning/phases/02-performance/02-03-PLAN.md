# 02-03: JavaScript Optimization

<objective>
Optimize JavaScript loading by adding defer/async attributes to non-critical scripts and auditing jQuery usage for potential removal.
</objective>

<context>
@websites/www.dinero.cash/index.html
@websites/www.dinero.cash/users.html
@websites/www.dinero.cash/agents.html
@websites/www.dinero.cash/assets/js/
@.planning/STATE.md
</context>

<tasks>
<task name="Audit JavaScript dependencies and usage">
1. Open `index.html`
2. Find all `<script>` tags (grep: `grep -n '<script' index.html`)
3. Document each script:
   - File name and path
   - Current attributes (defer, async, or none)
   - File size
   - What it's used for (from code inspection)
4. Identify critical scripts (needed for above-fold functionality):
   - Navigation toggle
   - Slider functionality
   - Skip link functionality
5. Identify non-critical scripts (can load later):
   - Analytics (if any)
   - Feature popup functionality
   - Form validation
6. Create audit document in memory
7. Repeat for users.html and agents.html
</task>

<task name="Add defer attribute to non-critical scripts">
1. Open `index.html`
2. For each non-critical script, add `defer` attribute:
   ```html
   <!-- Before -->
   <script src="assets/js/libs/jquery-3.5.1.min.js"></script>
   <script src="assets/js/webflow.schunk.e0c428ff9737f919.js"></script>

   <!-- After -->
   <script src="assets/js/libs/jquery-3.5.1.min.js" defer></script>
   <script src="assets/js/webflow.schunk.e0c428ff9737f919.js" defer></script>
   ```
3. Apply to all Webflow chunk files
4. Apply to jQuery if it's only used for below-fold functionality
5. Save index.html
6. Repeat for users.html and agents.html
</task>

<task name="Test functionality with deferred scripts">
1. Open index.html in browser
2. Test navigation:
   - Click hamburger menu, verify it opens
   - Verify dropdown works
3. Test sliders:
   - Verify hero slider works
   - Verify feature popup slider works
   - Check navigation arrows function
4. Test forms:
   - Verify form submission works
   - Check validation functions
5. Check browser console for errors:
   - Open DevTools → Console
   - Look for JavaScript errors
   - Fix any errors caused by deferred loading
6. If errors found, remove `defer` from affected script and document why
7. Save files
</task>

<task name="Measure JavaScript performance improvement">
1. Open Chrome DevTools → Performance tab
2. Record page load BEFORE optimization (if baseline exists)
3. Record page load AFTER optimization
4. Compare:
   - Parse/execute time for scripts
   - Total page load time
   - Time to interactive (TTI)
5. Document improvements in STATE.md
</task>
</tasks>

<success>
- [ ] All JavaScript dependencies audited and documented
- [ ] Critical vs non-critical scripts identified
- [ ] `defer` attribute added to non-critical scripts
- [ ] All Webflow chunk files deferred
- [ ] jQuery deferred or removed if possible
- [ ] Navigation functionality tested and works
- [ ] Slider functionality tested and works
- [ ] Form functionality tested and works
- [ ] No console errors related to script loading
- [ ] JavaScript parse/execute time improved
- [ ] Time to interactive (TTI) improved
</success>
